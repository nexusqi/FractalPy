# Fractal Atlas — Координатное Фрактальное Ядро (Русская версия)

## 1. Что это такое
Fractal Atlas — экспериментальная система, превращающая *книгу* в *непрерывную функцию*:
**адрес x → символ**.

Мы подаём не токены, а координаты на интервале [0,1], а модель учится восстанавливать правильную букву.  
Это **преднамеренное переобучение**, цель — заставить модель запомнить книгу максимально точно.

---

## 2. Основная идея
1. Берём строку текста.  
2. Преобразуем позиции в координаты `[0.0 … 1.0]`.  
3. Для каждой координаты вычисляем Fourier‑признаки (высокие и низкие частоты).  
4. Пропускаем через фрактальное ядро (одно и то же ядро повторяется *T* раз — самоподобие).  
5. На выходе — логиты по символам.  
6. Backprop учит модель восстанавливать текст.

```
x → Fourier(x) → h0 → h1 → h2 → ... → hT → логиты
```

---

## 3. Fourier-признаки (спектральный взрыв)
Для резких переходов между символами обычной координаты x недостаточно.

Поэтому используем признаки:

```
[x,
 sin(f1·x), cos(f1·x),
 sin(f2·x), cos(f2·x),
 ...
 sin(fK·x), cos(fK·x)]
```

В версиях V5–V8 частоты растут по **октавам**:

```
f_k = base_frequency * growth^k
```

Это даёт многоуровневое представление — низкие + высокие частоты.

---

## 4. Фрактальное ядро
Внутри сети есть *фрактальный блок*, который применяется **T раз подряд**:

```
h_{t+1} = (1−α)·h_t + α·tanh(FractalBlock(h_t))
```

Где:
- α — коэффициент смешивания
- T — глубина
- FractalBlock — один и тот же набор весов (weight‑sharing)
- z — латентный ключ книги (добавляется в V5+)

В V5+ добавлены:
- **Sparse updates** — 90% шагов могут быть статичными → стабильность + экономия  
- **Октавные частоты**  
- **Latent key z** — компактный вектор, который разворачивает конкретную книгу внутри фиксированного ядра

---

## 5. Atlas — мастер‑ядро + ключи книг
Чтобы хранить не одну книгу, а целую библиотеку, мы делаем:

1. Обучаем **мастер‑ядро** (V5/V7/V8).  
2. Замораживаем его.  
3. Для каждой новой книги обучаем только вектор **z** размером 32–64.  
4. Сохраняем его как `book_z.pt`.

В итоге:

```
Библиотека = одно ядро (несколько МБ) + 1000 ключей по 1–5 КБ
```

Это радикальное сжатие.

---

## 6. Структура репозитория

```
fractal_atlas_project/
│
├── fractal_decoder_v3.py     — базовое ядро
├── fractal_decoder_v5.py     — мастер‑ядро с октавами и sparse updates
├── fractal_decoder_v7.py     — улучшенная стабильность
├── fractal_decoder_v8.py     — новая версия для Atlas
│
├── train_single_book_v*.py   — обучение ядра
├── train_key_v5.py           — обучение латентного ключа
│
├── infer_single_book.py      — инференс
├── atlas_keys.py             — работа с ключами
│
└── data/
    ├── book_v3.txt
    ├── book_v5_master.txt
    ├── keys/
    └── ...
```

---

## 7. Как запустить

### 1) Установить зависимости
```
pip install torch
```

### 2) Положить текст мастер‑книги:

```
fractal_atlas_project/data/book_v5_master.txt
```

### 3) Обучить ядро
```
python3.11 -m fractal_atlas_project.train_single_book_v5
```

Создаст:
```
fractal_text_decoder_v5.pt
```

### 4) Обучить ключ для новой книги
```
python3.11 -m fractal_atlas_project.train_key_v5
```

### 5) Запустить инференс
```
python3.11 -m fractal_atlas_project.infer_single_book
```

---

## 8. Версии ядер

### V3 — базовый
- Простые Fourier‑фичи
- Без latent key
- Без sparse updates

### V5 — мастер‑ядро Atlas
- Октавные частоты
- Sparse updates
- Latent key
- Готово для библиотеки из многих книг

### V7 / V8 — улучшенные
- Лучшая спектральная устойчивость  
- Поддержка больших словарей  
- Более стабильная оптимизация глубины (T)

---

## 9. Что уже сделано (для Саши)
- Реализовано 8 версий фрактального ядра  
- Добавлены Fourier‑октавы  
- Сделаны sparse updates  
- Реализована архитектура Atlas (ядро + ключи)  
- Написаны тренеры для ядра и ключей  
- Готов пайплайн инференса  
- Проект полностью запускается локально  

Суть:  
**одно ядро + один вектор = одна книга**  
И так можно хранить огромную библиотеку.

---

## 10. Дальнейшие шаги
Готовы добавить:
- визуализацию скрытых состояний,
- квантование 8/4‑bit,
- экспорт в ONNX,
- интеграцию Rust/Candle,
- web‑демо.

---

## 11. Автор / команда
Serhii & Sasha — Fractal Atlas project.
