# Fractal Knowledge Distillation (M3 Edition)

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø–æ –¥–∏—Å—Ç–∏–ª–ª—è—Ü–∏–∏ –∑–Ω–∞–Ω–∏–π –∏–∑ –±–æ–ª—å—à–æ–π LLM (Qwen2.5-0.5B) –≤ –∫—Ä–æ—à–µ—á–Ω—É—é —Ñ—Ä–∞–∫—Ç–∞–ª—å–Ω—É—é —Å–µ—Ç—å.

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

**–ò–¥–µ—è:** –°–∂–∞—Ç—å –∑–Ω–∞–Ω–∏—è –±–æ–ª—å—à–æ–π –º–æ–¥–µ–ª–∏ –≤ –º–∞–ª–µ–Ω—å–∫—É—é —Ñ—Ä–∞–∫—Ç–∞–ª—å–Ω—É—é —Å–µ—Ç—å —Å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ü™∂ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ (~1-2 MB vs ~1 GB)
- ‚ö° –ë—ã—Å—Ç—Ä—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –ª—é–±–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
- üß† –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ "–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞" —á–µ—Ä–µ–∑ knowledge distillation
- üîÑ –§—Ä–∞–∫—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Å–∞–º–æ–ø–æ–¥–æ–±–∏–µ–º

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Teacher: Qwen2.5-0.5B
- –ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç "–º—è–≥–∫–∏–µ" –ª–æ–≥–∏—Ç—ã (soft targets)
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ float16 –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏

### Student: Fractal Network
- **Embeddings**: Token ‚Üí Hidden (256 dim)
- **Fractal Core**: 
  - –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–∑–Ω–∞—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–∏–º—É–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ split real/imag)
  - Weight-sharing: –æ–¥–∏–Ω –±–ª–æ–∫ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è T=10 —Ä–∞–∑
  - –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `Z_new = (1-Œ±)Z_old + Œ±¬∑œÉ(Layer(Z_old))`
- **Head**: Hidden ‚Üí Vocab

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** ~200K-500K (vs 500M —É Qwen)

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
cd fractal_distillation
pip install -r requirements.txt
```

## üöÄ –ó–∞–ø—É—Å–∫

```bash
python main.py
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ Teacher**: –°–∫–∞—á–∏–≤–∞–µ—Ç—Å—è Qwen2.5-0.5B (~1 GB, –æ–¥–∏–Ω —Ä–∞–∑)
2. **–°–æ–∑–¥–∞–Ω–∏–µ Student**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Ñ—Ä–∞–∫—Ç–∞–ª—å–Ω–∞—è —Å–µ—Ç—å
3. **–û–±—É—á–µ–Ω–∏–µ**: 
   - Teacher –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç soft targets
   - Student —É—á–∏—Ç—Å—è –∏—Ö –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ KL divergence
   - Loss –¥–æ–ª–∂–µ–Ω –ø–∞–¥–∞—Ç—å —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: –¢–µ—Å—Ç –Ω–∞ –ø—Ä–æ–º–ø—Ç–∞—Ö —Ç–∏–ø–∞ "Once upon a time"

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

- **Loss**: –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å ~5-10, –ø–∞–¥–∞–µ—Ç –¥–æ ~1-3
- **–ü–∞–º—è—Ç—å**: ~2-3 GB –Ω–∞ M3 Max
- **–í—Ä–µ–º—è**: ~10-30 –º–∏–Ω—É—Ç –Ω–∞ 5 —ç–ø–æ—Ö
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ–π (–Ω–µ —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã)

## üîß –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–í `main.py` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

```python
student = FractalStudent(
    vocab_size=vocab_size,
    hidden_dim=256,        # –†–∞–∑–º–µ—Ä —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    num_fractal_steps=10,   # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π —Ñ—Ä–∞–∫—Ç–∞–ª–∞
    alpha=0.5,              # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–º–µ—à–∏–≤–∞–Ω–∏—è
)

# Training
temperature=2.0            # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è softmax
learning_rate=1e-4         # Learning rate
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ–º–ø—Ç–∞—Ö:
- "Once upon a time"
- "The king said"
- "In the beginning"

–ï—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Å–º—ã—Å–ª–µ–Ω–Ω–∞—è (–∞ –Ω–µ "kjsdf87sdfs") ‚Äî **—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç —É—Å–ø–µ—à–µ–Ω!**

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
fractal_distillation/
‚îú‚îÄ‚îÄ main.py              # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ fractal_student.py   # –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ—Ä–∞–∫—Ç–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
‚îú‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üéì –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Knowledge Distillation

1. **Teacher** –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –ø–æ —Å–ª–æ–≤–∞—Ä—é
2. **Student** –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ—Ç –∂–µ —Ç–µ–∫—Å—Ç –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Teacher
3. **Loss**: KL Divergence –º–µ–∂–¥—É softmax(student_logits/T) –∏ softmax(teacher_logits/T)
4. **Temperature**: –î–µ–ª–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ "–º—è–≥—á–µ", –ø–µ—Ä–µ–¥–∞–≤–∞—è –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –§—Ä–∞–∫—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- **Weight-sharing**: –û–¥–∏–Ω –±–ª–æ–∫ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
- **–†–µ–∫—É—Ä—Å–∏—è**: –ö–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è —É–≥–ª—É–±–ª—è–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- **–°–∞–º–æ–ø–æ–¥–æ–±–∏–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —á–∏—Å–ª–∞**: –°–∏–º—É–ª–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ split real/imaginary

## üö® Troubleshooting

**Out of Memory:**
- –£–º–µ–Ω—å—à–∏—Ç–µ `batch_size` –≤ DataLoader
- –£–º–µ–Ω—å—à–∏—Ç–µ `hidden_dim` –∏–ª–∏ `num_fractal_steps`

**Loss –Ω–µ –ø–∞–¥–∞–µ—Ç:**
- –£–≤–µ–ª–∏—á—å—Ç–µ `temperature` (3.0-5.0)
- –£–≤–µ–ª–∏—á—å—Ç–µ `learning_rate` (–¥–æ 5e-4)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Teacher –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–º–æ—Ä–æ–∂–µ–Ω

**–ü–ª–æ—Ö–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è:**
- –û–±—É—á–∏—Ç–µ –±–æ–ª—å—à–µ —ç–ø–æ—Ö (10-20)
- –£–≤–µ–ª–∏—á—å—Ç–µ `num_fractal_steps` (–¥–æ 15-20)
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## üìö –°—Å—ã–ª–∫–∏

- [Knowledge Distillation Paper](https://arxiv.org/abs/1503.02531)
- [Qwen2.5 Models](https://huggingface.co/Qwen)
- [Fractal Networks](https://arxiv.org/abs/1605.07648)

---

**–ê–≤—Ç–æ—Ä**: Fractal Atlas Team  
**–í–µ—Ä—Å–∏—è**: M3 Edition (Apple Silicon Optimized)

